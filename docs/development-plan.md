# Детальный план разработки ClassVerse

На основе PRD подготовлен детальный план разработки проекта ClassVerse. План разбит на этапы в соответствии с приоритетами и логикой разработки.

## Этап 1: Настройка проекта и базовая инфраструктура

1. **Инициализация проекта Next.js**
   - Создание проекта с TypeScript, Tailwind CSS и ESLint
   - Настройка структуры директорий
   - Настройка базовых компонентов (layout, страницы)

2. **Настройка Supabase**
   - Создание проекта в Supabase
   - Настройка базы данных PostgreSQL
   - Создание основных таблиц (users, channels, messages, schedule)
   - Настройка RLS (Row Level Security) для безопасности

3. **Настройка аутентификации**
   - Интеграция с Supabase Auth
   - Настройка авторизации через Google OAuth
   - Настройка авторизации через email/password
   - Создание страниц входа, регистрации и восстановления пароля

## Этап 2: Разработка основных функций (MVP)

4. **Система чатов**
   - Разработка компонентов для личных сообщений
   - Разработка компонентов для групповых чатов
   - Создание каналов по предметам
   - Реализация базовых функций чата (отправка сообщений, просмотр истории)

5. **Расписание уроков**
   - Создание интерфейса для ручного ввода расписания
   - Разработка страницы просмотра расписания
   - Реализация уведомлений о начале урока

6. **Система отметки посещаемости**
   - Разработка интерфейса для отметки статуса ученика
   - Реализация статистики посещаемости

7. **Базовые мини-игры**
   - Разработка игры "Крестики-нолики"
   - Разработка игры "Морской бой"
   - Создание общего интерфейса для раздела игр

## Этап 3: Разработка уникальных функций

8. **Функция "Тайный друг"**
   - Разработка алгоритма подбора пар
   - Создание системы анонимных сообщений
   - Реализация уведомлений о новых "миссиях"

9. **Учебные инструменты**
   - Разработка генератора текстовых шпаргалок
   - Интеграция с API для проверки домашних заданий

10. **Система статусов и достижений**
    - Разработка механизма присвоения статусов
    - Создание страницы профиля с отображением статусов
    - Реализация системы достижений

11. **История класса**
    - Разработка общего альбома для фото/видео
    - Создание системы модерации контента
    - Реализация загрузки и отображения медиафайлов

## Этап 4: Интеграции и расширенные функции

12. **Интеграция с school.mos.ru**
    - Разработка API-клиента для взаимодействия с school.mos.ru
    - Автоматическое получение расписания
    - Синхронизация данных о домашних заданиях

13. **Система уведомлений**
    - Настройка Web Push API
    - Реализация различных типов уведомлений
    - Настройка предпочтений уведомлений для пользователей

14. **Голосовые каналы**
    - Интеграция WebRTC для голосовой связи
    - Разработка интерфейса голосовых каналов
    - Реализация функций управления голосовыми каналами

## Этап 5: Оптимизация и подготовка к релизу

15. **Оптимизация производительности**
    - Оптимизация запросов к базе данных
    - Улучшение времени загрузки страниц
    - Оптимизация работы на мобильных устройствах

16. **Тестирование и отладка**
    - Написание unit-тестов
    - Проведение интеграционных тестов
    - Тестирование безопасности

17. **Развертывание**
    - Настройка CI/CD с GitHub Actions
    - Развертывание на Vercel
    - Настройка мониторинга и аналитики

## Технические детали реализации

### Структура базы данных

1. **users**
   - id (PK)
   - name
   - email
   - role (student, teacher, admin)
   - status
   - avatar_url
   - created_at

2. **channels**
   - id (PK)
   - name
   - subject
   - admin_id (FK -> users.id)
   - created_at

3. **messages**
   - id (PK)
   - channel_id (FK -> channels.id)
   - user_id (FK -> users.id)
   - content
   - created_at

4. **schedule**
   - id (PK)
   - subject
   - day_of_week
   - start_time
   - end_time
   - teacher_id (FK -> users.id)

5. **attendance**
   - id (PK)
   - user_id (FK -> users.id)
   - date
   - status (present, absent, sick)

6. **homework**
   - id (PK)
   - subject
   - task
   - due_date
   - created_by (FK -> users.id)

7. **secret_friend_pairs**
   - id (PK)
   - sender_id (FK -> users.id)
   - receiver_id (FK -> users.id)
   - week_start_date
   - active

8. **secret_messages**
   - id (PK)
   - pair_id (FK -> secret_friend_pairs.id)
   - content
   - created_at

9. **memes**
   - id (PK)
   - user_id (FK -> users.id)
   - template_url
   - text_top
   - text_bottom
   - created_at

10. **moderation_requests**
    - id (PK)
    - content_id
    - content_type
    - moderator_id (FK -> users.id)
    - status
    - created_at

### Архитектура приложения

1. **Фронтенд**
   - Next.js для серверного рендеринга и маршрутизации
   - Tailwind CSS для стилизации
   - shadcn/ui для компонентов интерфейса
   - React Query для управления состоянием и кешированием данных
   - Zustand для глобального состояния приложения

2. **Бэкенд**
   - Supabase для хранения данных и аутентификации
   - Serverless функции Next.js API Routes для бизнес-логики
   - Supabase Realtime для обновлений в реальном времени

3. **Безопасность**
   - Supabase RLS для контроля доступа к данным
   - JWT для аутентификации
   - HTTPS для шифрования данных в пути

### Интерфейс пользователя

1. **Основные страницы**
   - Главная страница (дашборд)
   - Страница чатов
   - Страница расписания
   - Страница профиля
   - Страница мини-игр
   - Страница "Тайный друг"
   - Страница истории класса

2. **Компоненты**
   - Навигационная панель
   - Сайдбар с чатами
   - Чат-интерфейс
   - Календарь расписания
   - Карточки мини-игр
   - Модальные окна для различных действий
